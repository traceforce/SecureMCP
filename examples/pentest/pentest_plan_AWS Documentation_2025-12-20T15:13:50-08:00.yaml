metadata:
  version: "1.0"
  target: "AWS Documentation MCP Server"
  focus: "Critical security vulnerabilities"

tests:
  - test_id: "SEC-001"
    name: "Server-Side Request Forgery (SSRF) via URL Parameter"
    purpose: |
      Tests if the URL parameter can be exploited to access internal resources,
      cloud metadata services, or arbitrary external/internal hosts. SSRF vulnerabilities
      can lead to:
      - Exposure of AWS credentials from metadata service (169.254.169.254)
      - Access to internal network resources
      - Port scanning of internal infrastructure
      - Bypass of network security controls
      This is CRITICAL as successful exploitation could compromise the entire AWS environment.
    severity: "CRITICAL"
    
    test_cases:
      - case_id: "SEC-001-A"
        description: "Attempt to access AWS EC2 metadata service to retrieve IAM credentials"
        input:
          tool: "read_documentation"
          arguments:
            url: "http://169.254.169.254/latest/meta-data/iam/security-credentials/"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "must be from"
            - "docs.aws.amazon.com"
            - "domain"
            - "forbidden"
            - "not allowed"
          result: null
          error_response_must_not_match_regex:
            - "AKIA[0-9A-Z]{16}"
            - "AccessKeyId"
            - "SecretAccessKey"
            - "Token"
          error_response_must_not_contain:
            - "aws_access_key_id"
            - "aws_secret_access_key"
            - "aws_session_token"
      
      - case_id: "SEC-001-B"
        description: "Attempt to access localhost services via file protocol"
        input:
          tool: "read_documentation"
          arguments:
            url: "file:///etc/passwd"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "must be from"
            - "docs.aws.amazon.com"
            - "protocol"
            - "forbidden"
            - "not allowed"
          result: null
          error_response_must_not_contain:
            - "root:x:0:0"
            - "/bin/bash"
            - "/home/"
            - "nologin"

  - test_id: "SEC-002"
    name: "Path Traversal and Domain Validation Bypass"
    purpose: |
      Tests if the domain validation can be bypassed using URL manipulation techniques
      to access unauthorized domains or internal resources. Attackers could:
      - Use URL parsing discrepancies to bypass domain checks
      - Access arbitrary external sites for reconnaissance
      - Exploit subdomain validation weaknesses
      - Use URL encoding or special characters to bypass filters
      This is HIGH severity as it could lead to SSRF or access to malicious content.
    severity: "HIGH"
    
    test_cases:
      - case_id: "SEC-002-A"
        description: "Attempt domain validation bypass using @ symbol for credential/host confusion"
        input:
          tool: "read_documentation"
          arguments:
            url: "https://docs.aws.amazon.com@evil.com/malicious.html"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "must be from"
            - "docs.aws.amazon.com"
            - "domain"
            - "malformed"
          result: null
      
      - case_id: "SEC-002-B"
        description: "Attempt to bypass validation using URL encoding and special characters"
        input:
          tool: "read_documentation"
          arguments:
            url: "https://docs.aws.amazon.com%2eevil.com/test.html"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "must be from"
            - "docs.aws.amazon.com"
            - "domain"
            - "malformed"
          result: null

  - test_id: "SEC-003"
    name: "Information Disclosure in Error Messages"
    purpose: |
      Tests if error messages leak sensitive information about the server implementation,
      file paths, internal architecture, or system configuration. Information disclosure
      can help attackers:
      - Map the internal system architecture
      - Identify software versions with known vulnerabilities
      - Discover internal file paths for further attacks
      - Extract stack traces revealing code structure
      This is HIGH severity as it aids in crafting more sophisticated attacks.
    severity: "HIGH"
    
    test_cases:
      - case_id: "SEC-003-A"
        description: "Submit malformed URL to trigger error and check for stack trace leakage"
        input:
          tool: "read_documentation"
          arguments:
            url: "https://docs.aws.amazon.com/test/../../../etc/passwd.html"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, -32602]
          error_response_must_not_match_regex:
            - "at\\s+[A-Za-z]+\\.[A-Za-z]+\\s*\\("
            - "at\\s+async\\s+"
            - "Error:\\s+[A-Z][a-z]+Error:"
            - "/node_modules/"
            - "/usr/local/"
            - "/home/[a-z]+"
          error_response_must_not_contain:
            - "node_modules"
            - "at Object."
            - "at async"
            - "/usr/"
            - "/var/"
            - "/home/"
            - "C:\\"
            - "stack"
            - "internal"
            - "127.0.0.1"
            - "localhost"
      
      - case_id: "SEC-003-B"
        description: "Submit invalid max_length to trigger validation error and check for system info leakage"
        input:
          tool: "read_documentation"
          arguments:
            url: "https://docs.aws.amazon.com/index.html"
            max_length: 9999999999
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, -32602]
          error_response_must_not_match_regex:
            - "python|Python"
            - "node|Node\\.js"
            - "version\\s+\\d+\\.\\d+"
            - "/[a-z]+/[a-z]+/[a-z]+"
          error_response_must_not_contain:
            - "traceback"
            - "Traceback"
            - "File \""
            - "line "
            - ".py\""
            - ".js\""
            - "node_modules"
            - "site-packages"