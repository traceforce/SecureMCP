yaml
metadata:
  version: "1.0"
  target: "Atlassian MCP Server"
  focus: "Critical security vulnerabilities in authentication, authorization, and injection attacks"

tests:
  - test_id: "SEC-001"
    name: "Cloud ID Injection and SSRF via cloudId Parameter"
    purpose: |
      Tests for Server-Side Request Forgery (SSRF) vulnerabilities in the cloudId parameter.
      The cloudId accepts URLs and UUIDs, making it a potential vector for accessing internal
      resources, cloud metadata services, or localhost endpoints. Successful exploitation could
      allow attackers to:
      - Access AWS/GCP/Azure metadata services to steal credentials
      - Scan internal network resources
      - Access localhost services not exposed externally
      - Bypass network segmentation controls
    severity: "CRITICAL"
    
    test_cases:
      - case_id: "SEC-001-A"
        description: "Attempt to access AWS metadata service via cloudId URL parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "http://169.254.169.254/latest/meta-data/"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
            - "forbidden"
            - "unauthorized"
          result: null
          error_response_must_not_contain:
            - "ami-id"
            - "instance-id"
            - "security-credentials"
            - "iam/security-credentials"
      
      - case_id: "SEC-001-B"
        description: "Attempt to access localhost services via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "http://127.0.0.1:8080/admin"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
            - "forbidden"
          result: null
      
      - case_id: "SEC-001-C"
        description: "Attempt to access private network IP ranges via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "http://10.0.0.1/internal"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
            - "forbidden"
          result: null
      
      - case_id: "SEC-001-D"
        description: "Attempt file protocol handler access via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "file:///etc/passwd"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "unsupported protocol"
            - "forbidden"
          result: null
          error_response_must_not_contain:
            - "root:"
            - "/bin/bash"
            - "/bin/sh"
      
      - case_id: "SEC-001-E"
        description: "Attempt GCP metadata service access via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "http://metadata.google.internal/computeMetadata/v1/"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
            - "forbidden"
          result: null

  - test_id: "SEC-002"
    name: "Cross-Tenant Data Access via CloudId Manipulation"
    purpose: |
      Tests for authorization bypass vulnerabilities where an attacker with valid credentials
      attempts to access resources from other tenants/organizations by manipulating the cloudId.
      This tests horizontal privilege escalation where users could:
      - Access other organizations' Confluence spaces and sensitive data
      - Enumerate valid Cloud IDs belonging to other tenants
      - Bypass multi-tenant isolation controls
      - Leak information about other tenants' configurations
      Impact: Unauthorized access to confidential business data across tenant boundaries.
    severity: "CRITICAL"
    
    prerequisites:
      - description: "Obtain a valid cloudId from your own tenant using getAccessibleAtlassianResources"
        variable: "VALID_CLOUD_ID"
    
    test_cases:
      - case_id: "SEC-002-A"
        description: "Attempt to access resources using a different tenant's cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "00000000-0000-0000-0000-000000000000"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [401, 403, 404, -32602]
          error_message_contains_one_of:
            - "unauthorized"
            - "forbidden"
            - "not found"
            - "access denied"
            - "invalid cloud"
          result: null
          error_response_must_not_contain:
            - "space"
            - "pages"
            - "content"
      
      - case_id: "SEC-002-B"
        description: "Attempt sequential cloudId enumeration with modified UUID"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "ffffffff-ffff-ffff-ffff-ffffffffffff"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [401, 403, 404, -32602]
          error_message_contains_one_of:
            - "unauthorized"
            - "forbidden"
            - "not found"
            - "access denied"
          result: null
      
      - case_id: "SEC-002-C"
        description: "Test for information disclosure in error messages with invalid cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "12345678-1234-1234-1234-123456789abc"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [401, 403, 404, -32602]
          error_response_must_not_contain:
            - "Bearer"
            - "token"
            - "api_key"
            - "secret"
            - "password"
            - "/home/"
            - "/usr/"
            - "C:\\"
            - "127.0.0.1"
            - "localhost"
          error_response_must_not_match_regex:
            - "Bearer [a-zA-Z0-9_-]{20,}"
            - "token[\"']?\\s*:\\s*[\"'][a-zA-Z0-9_-]{20,}"
            - "[a-zA-Z0-9_-]{40,}"
            - "at [A-Za-z0-9_.]+\\.[A-Za-z]+:[0-9]+"

  - test_id: "SEC-003"
    name: "Injection Attacks in Filter Parameters"
    purpose: |
      Tests for injection vulnerabilities in space filtering parameters (keys, ids, labels).
      These parameters are used to construct queries and filter results, making them potential
      vectors for:
      - SQL injection if parameters are used in database queries
      - NoSQL injection if using document databases
      - Command injection if parameters are passed to system commands
      - LDAP injection if integrated with directory services
      - Cross-site scripting if parameters are reflected in responses
      Impact: Database compromise, data exfiltration, unauthorized data access, or code execution.
    severity: "HIGH"
    
    prerequisites:
      - description: "Obtain a valid cloudId from getAccessibleAtlassianResources"
        variable: "VALID_CLOUD_ID"
    
    test_cases:
      - case_id: "SEC-003-A"
        description: "SQL injection attempt in keys parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            keys: "' OR '1'='1"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "bad request"
            - "validation"
          result: null
          error_response_must_not_contain:
            - "syntax error"
            - "SQL"
            - "mysql"
            - "postgresql"
            - "ORA-"
            - "database"
      
      - case_id: "SEC-003-B"
        description: "SQL injection with UNION-based attack in keys array"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            keys: ["TEST", "' UNION SELECT password FROM users--"]
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "bad request"
          result: null
      
      - case_id: "SEC-003-C"
        description: "NoSQL injection attempt in labels parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            labels: "{\"$ne\": null}"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "bad request"
          result: null
      
      - case_id: "SEC-003-D"
        description: "Cross-site scripting payload in favoritedBy parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            favoritedBy: "<script>alert('XSS')</script>"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "bad request"
          result: null
          error_response_must_not_contain:
            - "<script>"
            - "alert("
            - "javascript:"

  - test_id: "SEC-004"
    name: "Resource Exhaustion via Pagination Abuse"
    purpose: |
      Tests for business logic flaws and resource exhaustion vulnerabilities through abuse of
      pagination parameters (limit, cursor). Attackers could:
      - Request excessive data volumes causing memory exhaustion
      - Perform denial-of-service attacks via oversized limit values
      - Bypass rate limiting through cursor manipulation
      - Enumerate all resources without proper throttling
      - Cause database performance degradation
      Impact: Service degradation, denial of service, or complete service unavailability.
    severity: "HIGH"
    
    prerequisites:
      - description: "Obtain a valid cloudId from getAccessibleAtlassianResources"
        variable: "VALID_CLOUD_ID"
    
    test_cases:
      - case_id: "SEC-004-A"
        description: "Attempt to request excessive limit beyond maximum (250)"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            limit: 999999
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 422, -32602]
          error_message_contains_one_of:
            - "limit"
            - "maximum"
            - "exceeded"
            - "invalid"
            - "too large"
          result: null
      
      - case_id: "SEC-004-B"
        description: "Test negative limit value handling"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            limit: -1
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "must be positive"
            - "greater than"
            - "validation"
          result: null
      
      - case_id: "SEC-004-C"
        description: "Test cursor manipulation with injection payload"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            cursor: "' OR 1=1--"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 422, -32602]
          error_message_contains_one_of:
            - "invalid cursor"
            - "malformed"
            - "bad request"
          result: null
      
      - case_id: "SEC-004-D"
        description: "Test extremely long cursor value for buffer overflow"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            cursor: "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 413, 422, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "too long"
            - "malformed"
            - "cursor"
          result: null

  - test_id: "SEC-005"
    name: "Authentication Token and Sensitive Information Disclosure"
    purpose: |
      Tests for information disclosure vulnerabilities across all tool endpoints. Even with
      proper authentication, error messages and responses may leak:
      - OAuth tokens or API keys in error details
      - Internal file paths revealing system architecture
      - Stack traces exposing code structure and dependencies
      - Database connection strings or credentials
      - Internal IP addresses and hostnames
      - Version information useful for targeted attacks
      Impact: Leaked credentials enable full account compromise; internal details aid further attacks.
    severity: "CRITICAL"
    
    test_cases:
      - case_id: "SEC-005-A"
        description: "Test for credential leakage in atlassianUserInfo error responses"
        input:
          tool: "atlassianUserInfo"
          arguments: {}
        expected_output:
          error_response_must_not_contain:
            - "Bearer"
            - "token"
            - "api_key"
            - "apiKey"
            - "secret"
            - "password"
            - "credential"
            - "Authorization:"
            - "access_token"
          error_response_must_not_match_regex:
            - "Bearer [a-zA-Z0-9_-]{20,}"
            - "token[\"']?\\s*[:=]\\s*[\"']?[a-zA-Z0-9_-]{20,}"
            - "[a-zA-Z0-9_-]{40,}"
            - "sk_[a-zA-Z0-9]{32,}"
      
      - case_id: "SEC-005-B"
        description: "Test for internal path disclosure in getAccessibleAtlassianResources"
        input:
          tool: "getAccessibleAtlassianResources"
          arguments: {}
        expected_output:
          error_response_must_not_contain:
            - "/home/"
            - "/usr/"
            - "/var/"
            - "/opt/"
            - "C:\\"
            - "C:/"
            - "node_modules"
            - ".js:"
            - ".ts:"
          error_response_must_not_match_regex:
            - "at [A-Za-z0-9_.]+\\.[A-Za-z]+:[0-9]+"
            - "/[a-z]+/[a-z]+/.*\\.(js|ts):"
      
      - case_id: "SEC-005-C"
        description: "Test for stack trace and internal IP disclosure with malformed cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "INVALID_CLOUD_ID_%%%"
        expected_output:
          success: false
          error_present: true
          error_response_must_not_contain:
            - "127.0.0.1"
            - "localhost"
            - "0.0.0.0"
            - "at Object."
            - "at async"
            - "at Function."
            - "Error:"
            - "stack:"
            - "node_modules"
            - "10.0."
            - "172.16."
            - "192.168."
          error_response_must_not_match_regex:
            - "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"
            - "at [A-Za-z0-9_.]+\\.[A-Za-z]+:[0-9]+"