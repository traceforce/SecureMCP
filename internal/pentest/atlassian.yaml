yaml
metadata:
  version: "1.0"
  target: "Atlassian MCP Server"
  focus: "Critical security vulnerabilities"

tests:
  - test_id: "SEC-001"
    name: "Cloud ID Injection and SSRF via cloudId Parameter"
    purpose: |
      Tests if the cloudId parameter is vulnerable to Server-Side Request Forgery (SSRF) attacks.
      Since cloudId is described as accepting UUIDs, URLs, or being extractable from Atlassian URLs,
      this creates potential for SSRF if the server attempts to resolve or fetch from attacker-controlled URLs.
      Critical impact: Could allow access to cloud metadata services (AWS/GCP/Azure), internal network resources,
      or local file systems, potentially exposing credentials, tokens, and sensitive infrastructure data.
    severity: "CRITICAL"
    
    test_cases:
      - case_id: "SEC-001-A"
        description: "AWS metadata service SSRF attempt via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "http://169.254.169.254/latest/meta-data/iam/security-credentials/"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
            - "forbidden"
            - "cloudid"
            - "uuid"
          error_response_must_not_contain:
            - "AccessKeyId"
            - "SecretAccessKey"
            - "Token"
            - "Expiration"
            - "aws"
            - "iam"
            - "role"
          result: null

      - case_id: "SEC-001-B"
        description: "GCP metadata service SSRF attempt via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
            - "forbidden"
          error_response_must_not_contain:
            - "access_token"
            - "token_type"
            - "expires_in"
            - "Bearer"
          result: null

      - case_id: "SEC-001-C"
        description: "Local network access via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "http://127.0.0.1:8080/admin"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
            - "forbidden"
          result: null

      - case_id: "SEC-001-D"
        description: "File protocol handler injection via cloudId"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "file:///etc/passwd"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, 404, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "protocol"
            - "scheme"
            - "forbidden"
          error_response_must_not_match_regex:
            - "root:.*:0:0:"
            - "bin:.*:/bin"
          error_response_must_not_contain:
            - "/bin/bash"
            - "/bin/sh"
            - "nologin"
          result: null

  - test_id: "SEC-002"
    name: "Cross-Tenant Data Access via CloudId Manipulation"
    purpose: |
      Tests authorization controls to ensure users cannot access data from Atlassian cloud instances
      they don't have permission to access. The cloudId parameter uniquely identifies an Atlassian
      Cloud instance, and improper validation could allow cross-tenant data breaches.
      Critical impact: Unauthorized access to other organizations' Confluence spaces, pages, and
      sensitive business data across different Atlassian tenants.
    severity: "CRITICAL"

    prerequisites:
      - description: "Obtain a valid cloudId for your authorized Atlassian instance"
        variable: "VALID_CLOUD_ID"
    
    test_cases:
      - case_id: "SEC-002-A"
        description: "Attempt access with null UUID (all zeros)"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "00000000-0000-0000-0000-000000000000"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [401, 403, 404, -32602]
          error_message_contains_one_of:
            - "unauthorized"
            - "forbidden"
            - "not found"
            - "access denied"
            - "invalid"
          result: null

      - case_id: "SEC-002-B"
        description: "Attempt access with randomly generated UUID"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [401, 403, 404, -32602]
          error_message_contains_one_of:
            - "unauthorized"
            - "forbidden"
            - "not found"
            - "access denied"
          result: null

      - case_id: "SEC-002-C"
        description: "Attempt SQL injection in cloudId to bypass authorization"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}' OR '1'='1"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 403, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "forbidden"
          result: null

  - test_id: "SEC-003"
    name: "Information Disclosure in Error Messages"
    purpose: |
      Tests whether error responses leak sensitive information such as authentication tokens,
      internal paths, stack traces, API keys, or system configuration details. Information
      disclosure can aid attackers in crafting more sophisticated attacks.
      High impact: Exposed credentials or tokens could lead to full account compromise,
      stack traces reveal application structure and vulnerabilities, internal paths expose
      deployment architecture.
    severity: "HIGH"
    
    test_cases:
      - case_id: "SEC-003-A"
        description: "Malformed cloudId to trigger error with potential info leak"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "<script>alert('xss')</script>"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
          error_response_must_not_match_regex:
            - "Bearer [a-zA-Z0-9_-]{20,}"
            - "token[\"']?\\s*:\\s*[\"'][a-zA-Z0-9_-]{20,}"
            - "[a-zA-Z0-9_-]{32,}"
            - "api[_-]?key[\"']?\\s*:\\s*[\"'][^\"']+"
          error_response_must_not_contain:
            - "/home/"
            - "/usr/"
            - "/var/"
            - "C:\\"
            - "at Object."
            - "at async"
            - "node_modules"
            - "password"
            - "secret"
            - "api_key"
            - "apiKey"
            - "127.0.0.1"
            - "localhost"
            - ".js:"
            - ".ts:"
            - "Error: "
            - "Stack trace"
          result: null

      - case_id: "SEC-003-B"
        description: "Invalid parameter combination to check stack trace exposure"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            limit: -9999999
            ids: "'; DROP TABLE spaces; --"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, -32602]
          error_response_must_not_match_regex:
            - "at [a-zA-Z0-9_]+\\.[a-zA-Z0-9_]+ \\([^)]+\\.[jt]s:\\d+:\\d+\\)"
            - "/[a-z_-]+/node_modules/"
            - "Internal server error:.*\\n.*at "
          error_response_must_not_contain:
            - "node_modules"
            - "dist/"
            - "src/"
            - ".js:"
            - ".ts:"
            - "at Function"
            - "at Object"
            - "at Module"
            - "stack"
            - "trace"
            - "oauth"
            - "clientSecret"
            - "clientId"
          result: null

      - case_id: "SEC-003-C"
        description: "Unicode/encoding attack to test parser error handling"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "\u0000\u0001\u0002\uffff"
            keys: ["\"><script>alert(1)</script>"]
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, -32602]
          error_response_must_not_contain:
            - "Exception"
            - "stacktrace"
            - "java."
            - "com.atlassian"
            - "internal"
            - "debug"
          result: null

  - test_id: "SEC-004"
    name: "Injection Attacks in Filter Parameters"
    purpose: |
      Tests for injection vulnerabilities in query filter parameters (keys, ids, labels, favoritedBy).
      These parameters likely translate to database queries or API calls, making them potential
      injection points for SQL, NoSQL, or LDAP injection attacks.
      High impact: Successful injection could allow unauthorized data access, data modification,
      or extraction of sensitive information from backend databases.
    severity: "HIGH"

    prerequisites:
      - description: "Obtain a valid cloudId for your authorized Atlassian instance"
        variable: "VALID_CLOUD_ID"
    
    test_cases:
      - case_id: "SEC-004-A"
        description: "SQL injection attempt in keys parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            keys: ["TEST' OR '1'='1", "TEST' UNION SELECT * FROM users--"]
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 404, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "not found"
            - "malformed"
          result: null

      - case_id: "SEC-004-B"
        description: "NoSQL injection attempt in ids parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            ids: ["1", "$ne", "null"]
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "type"
          result: null

      - case_id: "SEC-004-C"
        description: "LDAP injection attempt in favoritedBy parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            favoritedBy: "*)(uid=*))(|(uid=*"
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 404, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "malformed"
            - "not found"
          result: null

      - case_id: "SEC-004-D"
        description: "Path traversal attempt in labels parameter"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            labels: ["../../../etc/passwd", "..\\..\\..\\windows\\system32\\config\\sam"]
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 404, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "not found"
            - "malformed"
          result: null

  - test_id: "SEC-005"
    name: "Resource Exhaustion and DoS via Input Manipulation"
    purpose: |
      Tests if the API properly validates and limits resource-intensive operations.
      Attackers could abuse pagination limits, array sizes, or cursor manipulation
      to cause denial of service or excessive resource consumption.
      Medium-High impact: Could lead to service degradation, increased costs,
      or complete service unavailability affecting all users.
    severity: "HIGH"

    prerequisites:
      - description: "Obtain a valid cloudId for your authorized Atlassian instance"
        variable: "VALID_CLOUD_ID"
    
    test_cases:
      - case_id: "SEC-005-A"
        description: "Excessive limit value to cause resource exhaustion"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            limit: 999999999
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 413, -32602]
          error_message_contains_one_of:
            - "limit"
            - "maximum"
            - "too large"
            - "exceeded"
            - "invalid"
          result: null

      - case_id: "SEC-005-B"
        description: "Negative limit to test input validation"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            limit: -1
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, -32602]
          error_message_contains_one_of:
            - "invalid"
            - "negative"
            - "positive"
            - "limit"
          result: null

      - case_id: "SEC-005-C"
        description: "Massive array of IDs to test array size limits"
        input:
          tool: "getConfluenceSpaces"
          arguments:
            cloudId: "${VALID_CLOUD_ID}"
            ids: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50]
        expected_output:
          success: false
          error_present: true
          error_code_one_of: [400, 413, -32602]
          error_message_contains_one_of:
            - "too many"
            - "limit"
            - "maximum"
            - "exceeded"
            - "invalid"
          result: null